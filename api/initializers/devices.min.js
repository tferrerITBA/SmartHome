var _0x1ba6=['update','_id','name','remove','find','map','fromDto','findOne','join','config','paths','log','loading\x20device\x20database\x20[',']...','debug','ensureIndex','error','device\x20database\x20loaded','info','path','devices.db','models','device','toDto','devices','insert','context'];(function(_0x26da42,_0x50daf4){var _0x50cfe1=function(_0x5b7349){while(--_0x5b7349){_0x26da42['push'](_0x26da42['shift']());}};_0x50cfe1(++_0x50daf4);}(_0x1ba6,0xeb));var _0x61ba=function(_0x21ed00,_0x4bc0c7){_0x21ed00=_0x21ed00-0x0;var _0x5cc6eb=_0x1ba6[_0x21ed00];return _0x5cc6eb;};'use strict';var Datastore=require('nedb');var Path=require(_0x61ba('0x0'));module['exports']={'initialize':function(_0x2abf7f,_0x47c941){_0x2abf7f['devices']={'dbName':_0x61ba('0x1'),'create':function(_0x201914){return new Promise((_0xf250f6,_0x50942b)=>{var _0x5d7afa=_0x2abf7f[_0x61ba('0x2')][_0x61ba('0x3')][_0x61ba('0x4')](_0x201914);_0x2abf7f['db'][_0x61ba('0x5')][_0x61ba('0x6')](_0x5d7afa,(_0x232d37,_0x1400fb)=>{if(_0x232d37){_0x232d37[_0x61ba('0x7')]={'entity':{'type':'device','id':_0x5d7afa['name']}};_0x50942b(_0x232d37);}else{_0xf250f6(_0x2abf7f[_0x61ba('0x2')][_0x61ba('0x3')]['fromDto'](_0x1400fb));}});});},'update':function(_0x3d5b89){return new Promise((_0x429dec,_0x4c07c7)=>{var _0x23e719=_0x2abf7f[_0x61ba('0x2')][_0x61ba('0x3')][_0x61ba('0x4')](_0x3d5b89);_0x2abf7f['db']['devices'][_0x61ba('0x8')]({'_id':_0x23e719[_0x61ba('0x9')]},_0x23e719,{},(_0x364f95,_0x52b58e)=>{if(_0x364f95){_0x364f95['context']={'entity':{'type':_0x61ba('0x3'),'id':_0x23e719[_0x61ba('0xa')]}};_0x4c07c7(_0x364f95);}else{_0x429dec(_0x52b58e==0x1);}});});},'delete':function(_0x5e6ac8){return new Promise((_0x5ed484,_0x44a3b6)=>{_0x2abf7f['db'][_0x61ba('0x5')][_0x61ba('0xb')]({'_id':_0x5e6ac8},{},(_0x5708f6,_0x41f494)=>{if(_0x5708f6){_0x44a3b6(_0x5708f6);}else{_0x5ed484(_0x41f494==0x1);}});});},'retrieveAll':function(){return new Promise((_0x134c92,_0x160c54)=>{this;_0x2abf7f['db']['devices'][_0x61ba('0xc')]({},(_0x4c7399,_0x4849e5)=>{if(_0x4c7399){_0x160c54(_0x4c7399);}else{var _0x255ddd=_0x4849e5[_0x61ba('0xd')](_0x406be2=>{return _0x2abf7f[_0x61ba('0x2')][_0x61ba('0x3')][_0x61ba('0xe')](_0x406be2);});_0x134c92(_0x255ddd);}});});},'retrieveByRoomId':function(_0x588f3c){return new Promise((_0x4535a1,_0x5d1b4e)=>{this;_0x2abf7f['db'][_0x61ba('0x5')][_0x61ba('0xc')]({'roomId':_0x588f3c},(_0x494a13,_0x18bc03)=>{if(_0x494a13){_0x5d1b4e(_0x494a13);}else{var _0x25d3d8=_0x18bc03['map'](_0x21886f=>{return _0x2abf7f[_0x61ba('0x2')][_0x61ba('0x3')][_0x61ba('0xe')](_0x21886f);});_0x4535a1(_0x25d3d8);}});});},'retrieveByDeviceTypeId':function(_0x398111){return new Promise((_0x4ca067,_0x3c0f2c)=>{this;_0x2abf7f['db'][_0x61ba('0x5')][_0x61ba('0xc')]({'typeId':_0x398111},(_0x1e70d2,_0x58e3f8)=>{if(_0x1e70d2){_0x3c0f2c(_0x1e70d2);}else{var _0x5b2586=_0x58e3f8[_0x61ba('0xd')](_0x423c7b=>{return _0x2abf7f[_0x61ba('0x2')][_0x61ba('0x3')]['fromDto'](_0x423c7b);});_0x4ca067(_0x5b2586);}});});},'retrieveById':function(_0x205bd6){return new Promise((_0x3ab14a,_0x21dfbd)=>{_0x2abf7f['db'][_0x61ba('0x5')][_0x61ba('0xf')]({'_id':_0x205bd6},(_0x52d5a0,_0x153ad8)=>{if(_0x52d5a0){_0x21dfbd(_0x52d5a0);}else{_0x3ab14a(_0x2abf7f[_0x61ba('0x2')]['device'][_0x61ba('0xe')](_0x153ad8));}});});}};return _0x47c941();},'start':function(_0x1482a0,_0x3d5153){var _0x322cda=Path[_0x61ba('0x10')](_0x1482a0[_0x61ba('0x11')]['general'][_0x61ba('0x12')]['db'][0x0],_0x1482a0[_0x61ba('0x5')]['dbName']);_0x1482a0[_0x61ba('0x13')](_0x61ba('0x14')+_0x322cda+_0x61ba('0x15'),_0x61ba('0x16'));_0x1482a0['db']=_0x1482a0['db']||{};_0x1482a0['db']['devices']=new Datastore({'filename':_0x322cda,'autoload':!![]});_0x1482a0['db'][_0x61ba('0x5')][_0x61ba('0x17')]({'fieldName':'name','unique':!![]},_0x5dcdb1=>{if(_0x5dcdb1)_0x1482a0[_0x61ba('0x13')](_0x5dcdb1,_0x61ba('0x18'));});_0x1482a0[_0x61ba('0x13')](_0x61ba('0x19'),_0x61ba('0x1a'));return _0x3d5153();}};